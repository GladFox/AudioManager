# Audio Addressables Dialog Demo Spec

## 1. Цель
Сделать демонстрационный сценарий использования динамической загрузки аудио через Addressables на примере диалога:
- загрузка звуков диалога перед стартом,
- блокировка экрана с прогрессом в процентах,
- запуск звука на старте диалога,
- кнопки проигрывания реплик/звуков,
- повторная дозагрузка при включении звука.

Целевой релиз: `0.0.2-demo`.

## 2. Область работ
### Входит
- отдельная demo-сцена с UI
- demo-контроллер диалога
- блокирующий overlay с прогрессом загрузки
- интеграция с `PreloadByIds` / `SkipIfNotLoaded`
- обработка включения/выключения звука

### Не входит
- production UI/UX диалоговой системы
- локализация и сложная ветвистая логика диалогов
- серверные сценарии загрузки контента

## 3. Сценарий demo
1. При входе в сцену создается тестовый диалог (набор id звуков).
2. Вызывается preload этих id.
3. Экран блокируется:
- затемнение,
- текст по центру: `Загрузка звуков... X%`.
4. После завершения preload:
- блокировка снимается,
- автоматически проигрывается стартовый звук диалога.
5. В сцене есть UI-кнопки:
- `Play Line 1`, `Play Line 2`, `Play Line 3`
- `Replay Intro`
- `Toggle Sound On/Off`
6. При `Sound On`:
- повторная проверка missing clips для активного диалога,
- дозагрузка с тем же экраном прогресса.
7. При `Sound Off`:
- новые проигрывания не стартуют,
- preload не выполняется.

## 4. Требования к UI
### 4.1 Overlay загрузки
- Fullscreen panel поверх интерфейса.
- Полная блокировка интеракции с нижним UI (`CanvasGroup.blocksRaycasts = true`).
- Центрированный текст:
  - заголовок `Загрузка аудио`
  - прогресс `NN%`.

### 4.2 Кнопки demo
- Кнопки должны вызывать `PlayById` для звуков диалога.
- Кнопка переключения звука должна менять состояние `SoundEnabled` и запускать дозагрузку при включении.

## 5. Runtime требования
### 5.1 Диалоговые данные demo
Использовать простой контейнер:
- `dialogueId`
- `introSoundId`
- `lineSoundIds[]`

### 5.2 Preload
- Preload выполняется через `AudioManager.PreloadByIds(ids)`.
- В preload включаются:
  - intro sound,
  - line sounds.

### 5.3 Политика воспроизведения
- `OnDemandPlayPolicy = SkipIfNotLoaded`.
- Предполагается, что кнопки нажимаются после preload.
- Если звуки еще не загружены, `Play` возвращает `Invalid` без исключения.

### 5.4 Поведение sound toggle
- `Off`:
  - блокировать новые загрузки.
- `On`:
  - проверить активный диалог,
  - preload missing ids,
  - показать overlay-progress.

## 6. Debug и диагностика
- В логах demo фиксировать:
  - старт preload,
  - completion preload,
  - skipped play (если не загружено),
  - toggle on/off.

## 7. Acceptance Criteria
1. При загрузке сцены появляется блокирующий экран с процентом.
2. После завершения загрузки экран скрывается автоматически.
3. Стартовый звук проигрывается после preload completion.
4. Кнопки проигрывания корректно запускают звуки по id.
5. При `Sound Off` звуки не играют и preload не идет.
6. При `Sound On` запускается дозагрузка missing ids с прогрессом.
7. Нет исключений при быстром on/off и нажатии кнопок.

## 8. Технические артефакты
- Новая demo-сцена (или расширение текущей):
  - `AudioAddressablesDialogDemo.unity` (предпочтительно)
  - либо адаптация `AudioDemoScene.unity`
- Компоненты:
  - `AudioDialogDemoController`
  - `AudioLoadingOverlayView`
  - `AudioDemoSoundToggleBinder`

## 9. Definition of Done
- Demo-сценарий полностью воспроизводим вручную.
- Прогресс загрузки отображается корректно.
- Звуки диалога грузятся через Addressables и играют по id.
- Документация обновлена (Memory Bank + README при необходимости).
